// 导入页面路由模块
import router from '@ohos.router';
import CommonConstants from '../common/constants/CommonConstants'
import NoteInfo from '../common/bean/NoteInfo'
import { NotebookItem } from '../view/NotebookItem'
import { NoteInfoTable } from '../common/database/NoteInfo';

@Entry
@Component
struct MainPage {
  @State message: string = '主界面';
  @State noteInfoList: NoteInfo[] = []; // 笔记信息列表
  @State searchChangeValue:string=''
  @State searchSubmitValue:string=''
  @State month:boolean[]=[true,true,true,true,true,true,true,true,true,true,true,true]

  private controller:SearchController = new SearchController()
  private scroller:Scroller = new Scroller()
  private noteScroller:Scroller = new Scroller()
  private arr:number[] = [1,2,3,4,5,6,7,8,9,10,11,12]

  private new_id:number=0

  @Builder tabMonth(month: number) {
    Row(){
      Text(month.toString())
        .width(40)
        .height(40)
        .fontSize('20fp')
        .fontColor('#ffffff')
        .textAlign(TextAlign.Center)
        .backgroundColor(this.month[month-1] == true ? '#3366cc':'#ffa5c0e0')
        .margin(3)
        .onClick(()=>{
          if(this.month[month-1]){
            this.month[month-1]=false;
          }else{
            this.month[month-1]=true;
          }
          //点击选择月份相应的文件
        })
    }
  }

  build() {
    Row() {
      Column() {
        Column(){
          Search({value:this.searchChangeValue,placeholder:'请输入搜索内容',controller:this.controller})
            .width('100%')
            .height(30)
            .onSubmit((value:string)=>{
              this.searchSubmitValue = value
            })
        }//搜索栏
        Column(){
          Text('月份')
            .fontSize(20)
            .fontWeight(FontWeight.Bold)
            .margin(15)
          Scroll(this.scroller){
            Row(){
              ForEach(this.arr,(item)=>{
                this.tabMonth(item)
              },item=>item)
            }
          }
          .scrollBar(BarState.Off)
          .scrollable(ScrollDirection.Horizontal)

          ScrollBar({scroller:this.scroller,direction:ScrollBarDirection.Horizontal,state:BarState.Auto}){
            Text()
              .height(20)
              .backgroundColor('#C0C0C0')
          }
        }//月份筛选
        Column(){
          Text(this.message)
            .fontSize(20)
            .fontWeight(FontWeight.Bold)
          Divider()
            .margin({top:15})
          Button('新建笔记',{ type: ButtonType.Capsule})
            .onClick(()=>{
              this.noteInfoList.push({
                id: this.new_id++,
                title: "笔记"+this.new_id.toString(),
                content: "我是内容1",
                date: "03/20",
                imageArr: ""
              })
            }).borderRadius(8)
              .backgroundColor(0x517a11)

          // 笔记列表
          Scroll(this.noteScroller){
            Flex({direction:FlexDirection.Column}){
              ForEach(this.noteInfoList,(item,index)=>{
                Column(){
                  if(this.month[item.date.toString().substring(0,2)-1]){
                    NotebookItem({
                      noteInfo: item,
                      // click: (id) => {
                      //   // todo 点击笔记，跳转至详情页
                      //   router.pushUrl({url:'pages/NotePage'}).then(()=>{
                      //
                      //   }).catch(()=>{
                      //
                      //   })
                      // },
                      // delete: (id) => {
                      //   // todo 删除笔记
                      // }
                    })
                  }
                  //Text(index.toString())
                  //  .height(30)
                  //  .width('100%')
                }
              },item=>item)
            }
            .margin({top:15})
          }
          .scrollBar(BarState.Off)
          .scrollable(ScrollDirection.Vertical)
          .priorityGesture(PanGesture)
          .backgroundColor('#fff0f1f3')

          ScrollBar({scroller:this.noteScroller,direction:ScrollBarDirection.Vertical,state:BarState.Auto}){
            Text()
              .height(20)
              .backgroundColor('#C0C0C0')
          }
          // List({ space: 0, initialIndex: 0,scroller:this.noteScroller }) {
          //   // ForEach(this.noteInfoList, (item, index) => {
          //   //   ListItem() {
          //   //     NotebookItem({
          //   //       noteInfo: item,
          //   //       click: (id) => {
          //   //         // todo 点击笔记，跳转至详情页
          //   //         router.pushUrl({url:'pages/NotePage'}).then(()=>{
          //   //
          //   //         }).catch(()=>{
          //   //
          //   //         })
          //   //       },
          //   //       delete: (id) => {
          //   //         // todo 删除笔记
          //   //       }
          //   //     })
          //   //   }
          //   // })
          // }
          // .width(CommonConstants.FULL_WIDTH)
          // .height(CommonConstants.FULL_HEIGHT)
          // .edgeEffect(EdgeEffect.Spring)
          // .onScrollIndex((firstIndex:number,lastIndex:number)=>{
          //
          // })
          // .backgroundColor($r('app.color.background'))
        }.layoutWeight(1)//笔记列表
        Text()
          .height(20)
          .backgroundColor('#C0C0C0')
      }
      .width('90%')
      .margin('5%')
    }
    .height('100%')
  }

  // 生命周期函数
  onPageShow(): void {
    this.refreshData()
  }

  // 查询笔记数据
  refreshData() {
    // todo 查询笔记数据
    // 为了展示页面效果添加的临时数据
    this.noteInfoList = [
      {
        id: this.new_id++,
        title: "笔记"+this.new_id.toString(),
        content: "我是内容",
        date: "03/20",
        imageArr: ""
      },
      {
        id: this.new_id++,
        title: "笔记"+this.new_id.toString(),
        content: "我是内容",
        date: "02/21",
        imageArr: ""
      },
      {
        id: this.new_id++,
        title: "笔记"+this.new_id.toString(),
        content: "我是内容",
        date: "02/21",
        imageArr: ""
      },
      {
        id: this.new_id++,
        title: "笔记"+this.new_id.toString(),
        content: "我是内容",
        date: "02/21",
        imageArr: ""
      },
      {
        id: this.new_id++,
        title: "笔记"+this.new_id.toString(),
        content: "我是内容",
        date: "01/21",
        imageArr: ""
      },
      {
        id: this.new_id++,
        title: "笔记"+this.new_id.toString(),
        content: "我是内容",
        date: "01/21",
        imageArr: ""
      }
    ]
  }
}
